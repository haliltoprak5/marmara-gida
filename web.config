<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        
        <!-- Default Document Ayarları -->
        <defaultDocument enabled="true">
            <files>
                <clear />
                <add value="index.html" />
                <add value="index.php" />
                <add value="default.html" />
            </files>
        </defaultDocument>
        
        <!-- URL Rewrite Kuralları -->
        <rewrite>
            <rules>
                <!-- HTTPS Yönlendirme - HTTP'den HTTPS'ye yönlendir -->
                <rule name="Redirect HTTP to HTTPS" stopProcessing="true">
                    <match url="(.*)" />
                    <conditions>
                        <add input="{HTTPS}" pattern="^OFF$" />
                        <add input="{HTTP_HOST}" pattern="^www\.marmaragida\.com\.tr$" />
                    </conditions>
                    <action type="Redirect" url="https://www.marmaragida.com.tr/{R:1}" redirectType="Permanent" />
                </rule>
                
                <!-- www olmadan gelenleri www'ye yönlendir -->
                <rule name="Redirect to www" stopProcessing="true">
                    <match url="(.*)" />
                    <conditions>
                        <add input="{HTTP_HOST}" pattern="^marmaragida\.com\.tr$" />
                    </conditions>
                    <action type="Redirect" url="https://www.marmaragida.com.tr/{R:1}" redirectType="Permanent" />
                </rule>
                
                <!-- .html uzantısını gizle - SEO için redirect -->
                <rule name="Remove HTML extension" stopProcessing="true">
                    <match url="^(.*)\.html$" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" />
                    </conditions>
                    <action type="Redirect" url="{R:1}" redirectType="Permanent" />
                </rule>
                
                <!-- Temiz URL'leri .html dosyalarına yönlendir -->
                <rule name="Add HTML extension" stopProcessing="true">
                    <match url="^(.*)$" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
                        <add input="{REQUEST_FILENAME}.html" matchType="IsFile" />
                    </conditions>
                    <action type="Rewrite" url="{R:1}.html" />
                </rule>
                
                <!-- Trailing slash ekle (SEO için) - HTML dosyalarını hariç tut -->
                <rule name="Add trailing slash" stopProcessing="true">
                    <match url="(.*[^/])$" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
                        <add input="{REQUEST_FILENAME}" pattern="\.html$" negate="true" />
                        <add input="{REQUEST_FILENAME}" pattern="\.htm$" negate="true" />
                    </conditions>
                    <action type="Redirect" url="{R:1}/" redirectType="Permanent" />
                </rule>
            </rules>
        </rewrite>
        
        <!-- Güvenlik Başlıkları (Security Headers) -->
        <httpProtocol>
            <customHeaders>
                <!-- XSS Protection -->
                <add name="X-XSS-Protection" value="1; mode=block" />
                
                <!-- Content Type Options - MIME type sniffing'i engelle -->
                <add name="X-Content-Type-Options" value="nosniff" />
                
                <!-- Frame Options - Clickjacking koruması -->
                <add name="X-Frame-Options" value="SAMEORIGIN" />
                
                <!-- Referrer Policy -->
                <add name="Referrer-Policy" value="strict-origin-when-cross-origin" />
                
                <!-- Permissions Policy (eski Feature-Policy) -->
                <add name="Permissions-Policy" value="geolocation=(), microphone=(), camera=()" />
                
                <!-- Strict Transport Security (HSTS) - HTTPS zorunluluğu -->
                <add name="Strict-Transport-Security" value="max-age=31536000; includeSubDomains; preload" />
                
                <!-- Content Security Policy (CSP) - XSS ve injection saldırılarına karşı -->
                <add name="Content-Security-Policy" value="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://fonts.googleapis.com https://www.google.com https://www.gstatic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self'; frame-src https://www.google.com;" />
                
                <!-- CORS Ayarları (Sadece mailer.php için) -->
                <add name="Access-Control-Allow-Methods" value="GET, POST, OPTIONS" />
                <add name="Access-Control-Allow-Headers" value="Content-Type" />
            </customHeaders>
        </httpProtocol>
        
        <!-- Static Content Compression (Gzip) -->
        <urlCompression doStaticCompression="true" doDynamicCompression="true" />
        <httpCompression>
            <dynamicTypes>
                <add mimeType="text/*" enabled="true" />
                <add mimeType="message/*" enabled="true" />
                <add mimeType="application/javascript" enabled="true" />
                <add mimeType="application/json" enabled="true" />
                <add mimeType="*/*" enabled="false" />
            </dynamicTypes>
            <staticTypes>
                <add mimeType="text/*" enabled="true" />
                <add mimeType="message/*" enabled="true" />
                <add mimeType="application/javascript" enabled="true" />
                <add mimeType="application/atom+xml" enabled="true" />
                <add mimeType="application/xaml+xml" enabled="true" />
                <add mimeType="image/svg+xml" enabled="true" />
                <add mimeType="*/*" enabled="false" />
            </staticTypes>
        </httpCompression>
        
        <!-- MIME Types -->
        <staticContent>
            <!-- HTML MIME Types -->
            <mimeMap fileExtension=".html" mimeType="text/html; charset=utf-8" />
            <mimeMap fileExtension=".htm" mimeType="text/html; charset=utf-8" />
            
            <!-- Diğer MIME Types -->
            <mimeMap fileExtension=".json" mimeType="application/json" />
            <mimeMap fileExtension=".woff" mimeType="application/font-woff" />
            <mimeMap fileExtension=".woff2" mimeType="application/font-woff2" />
            <mimeMap fileExtension=".webp" mimeType="image/webp" />
            <mimeMap fileExtension=".svg" mimeType="image/svg+xml" />
            <mimeMap fileExtension=".css" mimeType="text/css; charset=utf-8" />
            <mimeMap fileExtension=".js" mimeType="application/javascript; charset=utf-8" />
        </staticContent>
        
        <!-- Cache Control Headers -->
        <staticContent>
            <clientCache cacheControlMode="UseMaxAge" cacheControlMaxAge="30.00:00:00" />
        </staticContent>
        
        <!-- Özel Cache Kuralları -->
        <caching>
            <profiles>
                <add extension=".css" policy="CacheUntilChange" kernelCachePolicy="CacheUntilChange" />
                <add extension=".js" policy="CacheUntilChange" kernelCachePolicy="CacheUntilChange" />
                <add extension=".jpg" policy="CacheUntilChange" kernelCachePolicy="CacheUntilChange" />
                <add extension=".png" policy="CacheUntilChange" kernelCachePolicy="CacheUntilChange" />
                <add extension=".webp" policy="CacheUntilChange" kernelCachePolicy="CacheUntilChange" />
                <add extension=".svg" policy="CacheUntilChange" kernelCachePolicy="CacheUntilChange" />
                <add extension=".woff" policy="CacheUntilChange" kernelCachePolicy="CacheUntilChange" />
                <add extension=".woff2" policy="CacheUntilChange" kernelCachePolicy="CacheUntilChange" />
            </profiles>
        </caching>
        
        <!-- Hata Sayfaları -->
        <httpErrors errorMode="Custom" defaultResponseMode="ExecuteURL">
            <remove statusCode="404" />
            <error statusCode="404" path="/404.html" responseMode="ExecuteURL" />
            <remove statusCode="500" />
            <error statusCode="500" path="/500.html" responseMode="ExecuteURL" />
            <remove statusCode="403" />
            <error statusCode="403" path="/403.html" responseMode="ExecuteURL" />
        </httpErrors>
        
        <!-- Directory Browsing Kapalı -->
        <directoryBrowse enabled="false" />
        
        <!-- Güvenlik: Hassas Dosyalara Erişimi Engelle -->
        <security>
            <requestFiltering>
                <!-- Gizli dosyaları engelle -->
                <hiddenSegments>
                    <add segment=".git" />
                    <add segment=".svn" />
                    <add segment=".env" />
                    <add segment="web.config" />
                    <add segment=".htaccess" />
                </hiddenSegments>
                
                <!-- Dosya uzantılarını engelle -->
                <fileExtensions>
                    <add fileExtension=".bak" allowed="false" />
                    <add fileExtension=".old" allowed="false" />
                    <add fileExtension=".tmp" allowed="false" />
                    <add fileExtension=".log" allowed="false" />
                    <add fileExtension=".sql" allowed="false" />
                    <add fileExtension=".md" allowed="false" />
                </fileExtensions>
                
                <!-- Maksimum istek boyutu -->
                <requestLimits maxAllowedContentLength="10485760" />
            </requestFiltering>
        </security>
        
        <!-- HTTP Redirect Ayarları -->
        <httpRedirect enabled="false" />
        
        <!-- Modül Ayarları -->
        <modules runAllManagedModulesForAllRequests="true" />
        
        <!-- Handler Ayarları - PHP ve Static Content -->
        <handlers>
            <!-- PHP Handler -->
            <add name="PHP_via_FastCGI" path="*.php" verb="GET,HEAD,POST" modules="FastCgiModule" scriptProcessor="C:\PHP\php-cgi.exe" resourceType="Either" requireAccess="Script" />
        </handlers>
        
    </system.webServer>
    
    <!-- .NET Framework Ayarları -->
    <system.web>
        <!-- Custom Errors - Production'da kapalı, hata sayfalarını kullan -->
        <customErrors mode="RemoteOnly" defaultRedirect="/500.html">
            <error statusCode="404" redirect="/404.html" />
            <error statusCode="500" redirect="/500.html" />
        </customErrors>
        
        <!-- Compilation Debug Kapalı (Performans için) -->
        <compilation debug="false" targetFramework="4.0" />
        
        <!-- Session State Ayarları -->
        <sessionState timeout="20" />
        
        <!-- HTTP Runtime Ayarları -->
        <httpRuntime maxRequestLength="10240" executionTimeout="300" />
        
        <!-- Globalization -->
        <globalization culture="tr-TR" uiCulture="tr-TR" fileEncoding="utf-8" />
        
        <!-- Trust Level -->
        <trust level="Full" />
    </system.web>
    
    <!-- Location Tag - mailer.php için özel ayarlar -->
    <location path="mailer.php">
        <system.webServer>
            <httpProtocol>
                <customHeaders>
                    <add name="Access-Control-Allow-Origin" value="*" />
                    <add name="Access-Control-Allow-Methods" value="POST, OPTIONS" />
                    <add name="Access-Control-Allow-Headers" value="Content-Type" />
                </customHeaders>
            </httpProtocol>
        </system.webServer>
    </location>
    
</configuration>
